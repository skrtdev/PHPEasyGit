<?php
function random_sha256(){
    return substr(hash("sha256", random_bytes(25)), 0, 20);

    $hash = hash("sha256", random_bytes(25));
    $len = 20;
    $i = 0;
    $res = "";
    while($i < $len){
        $res .= $hash[random_int(0, 64)];
        $i++;
    }
    return $res;
}

$sha = random_sha256();
mkdir(dirname(__FILE__)."/".$sha);

$array = [
    "GithubApi.php" => "PD9waHAKY2xhc3MgX0Vhc3lHaXR7CgoKICAgIHByaXZhdGUgJGFwaV91cmwgPSAiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS8iOwogICAgcHJpdmF0ZSAkanNvbjsKCgogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCl7CiAgICAgICAgJHRoaXMtPmpzb24gPSBqc29uX2RlY29kZShpbXBsb2RlKGZpbGUoZGlybmFtZShfX0ZJTEVfXykuIi9tYWluLmpzb24iKSksIHRydWUpOwogICAgICAgICR0aGlzLT5wYWNrYWdlc19zcmMgPSBkaXJuYW1lKF9fRklMRV9fKS4iL3BhY2thZ2VzLyI7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIEFQSUNhbGwoc3RyaW5nICRwYXRoKXsKCiAgICAgICAgJGhlYWRlcnMgPSBbIkFjY2VwdDogYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29uIl07CiAgICAgICAgaWYoaXNzZXQoJHRoaXMtPmpzb25bJ09BdXRoLVRva2VuJ10pKSAkaGVhZGVyc1tdID0gIkF1dGhvcml6YXRpb246IHRva2VuICIuJHRoaXMtPmpzb25bJ09BdXRoLVRva2VuJ107CgogICAgICAgICRjaCA9IGN1cmxfaW5pdCgpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsICR0aGlzLT5hcGlfdXJsLiRwYXRoKTsKICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVNFUkFHRU5ULCAnUEhQRWFzeUdpdCcpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgdHJ1ZSk7CiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX0hUVFBIRUFERVIsICRoZWFkZXJzKTsKICAgICAgICAvL2N1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9IRUFERVIsIHRydWUpOwoKICAgICAgICAkb3V0cHV0ID0gY3VybF9leGVjKCRjaCk7CiAgICAgICAgLy9lY2hvICRvdXRwdXQ7CiAgICAgICAgY3VybF9jbG9zZSgkY2gpOwogICAgICAgICRkZWNvZGVkID0ganNvbl9kZWNvZGUoJG91dHB1dCwgVFJVRSk7CgogICAgICAgIHJldHVybiAkZGVjb2RlZDsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jYWxsKHN0cmluZyAkbmFtZSwgYXJyYXkgJGFyZ3VtZW50cyl7CiAgICAgICAgcmV0dXJuICR0aGlzLT5BUElDYWxsKCRuYW1lLiIvIi4kYXJndW1lbnRzWzBdKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5zdGFsbFBhY2thZ2Uoc3RyaW5nICRyZXBvc2l0b3J5X25hbWUpewogICAgICAgICRyZXBvc2l0b3J5ID0gJHRoaXMtPnJlcG9zKCRyZXBvc2l0b3J5X25hbWUpOwogICAgICAgICRyZXBvc2l0b3J5X2NvbnRlbnQgPSAkdGhpcy0+cmVwb3MoJHJlcG9zaXRvcnlfbmFtZS4iL2NvbnRlbnRzIik7CgogICAgICAgICRwYWNrYWdlc19zcmMgPSAkdGhpcy0+cGFja2FnZXNfc3JjOwogICAgICAgICRwYWNrYWdlc3JjID0gJHBhY2thZ2VzX3NyYy4kcmVwb3NpdG9yeV9uYW1lLiIvc3JjIjsKCiAgICAgICAgLy9lY2hvIGpzb25fZW5jb2RlKCRyZXBvc2l0b3J5X2NvbnRlbnQpOwogICAgICAgIGlmKCR0aGlzLT5maWxlSW5EaXIoJHJlcG9zaXRvcnlfY29udGVudCwgIlBIUEVhc3lHaXQuanNvbiIpICE9PSBmYWxzZSl7CiAgICAgICAgICAgIC8vZWNobyAiaXMgYSBnaXQiLCAiXG4iOwogICAgICAgICAgICAkZWFzeWdpdCA9IGpzb25fZGVjb2RlKCR0aGlzLT5jdXJsKCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vJHJlcG9zaXRvcnlfbmFtZS8iLiRyZXBvc2l0b3J5WydkZWZhdWx0X2JyYW5jaCddLiIvUEhQRWFzeUdpdC5qc29uIiksIHRydWUpOwogICAgICAgICAgICAvL3Zhcl9kdW1wKCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vJHJlcG9zaXRvcnlfbmFtZS8iLiRyZXBvc2l0b3J5WydkZWZhdWx0X2JyYW5jaCddLiIvUEhQRWFzeUdpdC5qc29uIik7CiAgICAgICAgfQogICAgICAgIGVsc2VpZigkdGhpcy0+ZmlsZUluRGlyKCRyZXBvc2l0b3J5X2NvbnRlbnQsICJjb21wb3Nlci5qc29uIikgIT09IGZhbHNlKXsKICAgICAgICAgICAgLy9lY2hvICJmdWNrIGlzIGEgY29tcG9zZXIiLCAiXG4iOwogICAgICAgICAgICAkZWFzeWdpdCA9ICR0aGlzLT5jb21wb3NlclRvRWFzeUdpdChqc29uX2RlY29kZSgkdGhpcy0+Y3VybCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tLyRyZXBvc2l0b3J5X25hbWUvIi4kcmVwb3NpdG9yeVsnZGVmYXVsdF9icmFuY2gnXS4iL2NvbXBvc2VyLmpzb24iKSwgdHJ1ZSkpOwogICAgICAgIH0KCiAgICAgICAgaWYoaXNzZXQoJGVhc3lnaXQpKXsKICAgICAgICAgICAgLy9lY2hvICJpbiB0aGUgZ2l0IiwgIlxuIjsKCiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5X21lcmdlKCRlYXN5Z2l0WydhdXRvbG9hZCddLCAkZWFzeWdpdFsnaW1wb3J0J10pIGFzICRhdXRvbG9hZCkgewogICAgICAgICAgICAgICAgLy8gY29kZS4uLgogICAgICAgICAgICAgICAgY29weSgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tLyRyZXBvc2l0b3J5X25hbWUvIi4kcmVwb3NpdG9yeVsnZGVmYXVsdF9icmFuY2gnXS4iLyRhdXRvbG9hZCIsICRwYWNrYWdlc3JjLiIvJGF1dG9sb2FkIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCRwYWNrYWdlc19zcmMuJHJlcG9zaXRvcnlfbmFtZS4iL3BhY2thZ2UuanNvbiIsIGpzb25fZW5jb2RlKCRlYXN5Z2l0KSk7CiAgICAgICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCRwYWNrYWdlc19zcmMuJHJlcG9zaXRvcnlfbmFtZS4iL2F1dG9sb2FkLnBocCIsIGJhc2U2NF9kZWNvZGUoIlBEOXdhSEFOQ2cwS0pHcHpiMjRnUFNCcWMyOXVYMlJsWTI5a1pTaHBiWEJzYjJSbEtHWnBiR1VvWkdseWJtRnRaU2hmWDBaSlRFVmZYeWt1SWk5d1lXTnJZV2RsTG1wemIyNGlLU2twT3cwS1ptOXlaV0ZqYUNBb0pHcHpiMjR0UG1GMWRHOXNiMkZrSUdGeklDUm1hV3hsY0dGMGFDa2dldzBLSUNBZ0lISmxjWFZwY21VZ1pHbHlibUZ0WlNoZlgwWkpURVZmWHlrdUlpOXpjbU12SkdacGJHVndZWFJvSWpzTkNuME5DZzBLUHo0TkNnPT0iKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBhdXRvbG9hZFBhY2thZ2UoJHBhY2thZ2UpewoKICAgICAgICAkcGFja2FnZXNfc3JjID0gJHRoaXMtPnBhY2thZ2VzX3NyYzsKICAgICAgICBpZighaXNfZGlyKCRwYWNrYWdlc19zcmMpKXsKICAgICAgICAgICAgbWtkaXIoJHBhY2thZ2VzX3NyYyk7CiAgICAgICAgfQogICAgICAgICRvbGRfZGlyID0gIiI7CiAgICAgICAgZm9yZWFjaChleHBsb2RlKCIvIiwgJHBhY2thZ2UpIGFzICRkaXIpewogICAgICAgICAgICAkdGhpc2RpciA9ICRwYWNrYWdlc19zcmMuJG9sZF9kaXIuJGRpcjsKICAgICAgICAgICAgaWYoIWlzX2RpcigkdGhpc2RpcikpewogICAgICAgICAgICAgICAgbWtkaXIoJHRoaXNkaXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRvbGRfZGlyIC49ICRkaXIuIi8iOwogICAgICAgIH0KICAgICAgICAvLyBjcmVhdGUgc3JjIGluIHBhY2thZ2UgZm9sZGVyCiAgICAgICAgJHBhY2thZ2VzcmMgPSAkcGFja2FnZXNfc3JjLiRwYWNrYWdlLiIvc3JjIjsKICAgICAgICBpZighaXNfZGlyKCRwYWNrYWdlc3JjKSl7CiAgICAgICAgICAgIG1rZGlyKCRwYWNrYWdlc3JjKTsKICAgICAgICB9CgogICAgICAgIGlmKGNvdW50KHNjYW5kaXIoJHBhY2thZ2VzcmMpKSA9PT0gMiApeyAvLyBub24gYyfDqCBuZ2F6IG5lbGxhIGNhcnRlbGxhCiAgICAgICAgICAgICR0aGlzLT5pbnN0YWxsUGFja2FnZSgkcGFja2FnZSk7CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlICRwYWNrYWdlc19zcmMuJHBhY2thZ2UuIi9hdXRvbG9hZC5waHAiOwoKICAgIH0KCiAgICBwcml2YXRlIGZ1bmN0aW9uIGZpbGVJbkRpcihhcnJheSAkZGlyLCBzdHJpbmcgJGZpbGVuYW1lKXsKICAgICAgICBmb3JlYWNoKCRkaXIgYXMgJGZpbGUpewogICAgICAgICAgICBpZigkZmlsZVsnbmFtZSddID09PSAkZmlsZW5hbWUpIHJldHVybiAkZmlsZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHByaXZhdGUgZnVuY3Rpb24gY29tcG9zZXJUb0Vhc3lHaXQoYXJyYXkgJGNvbXBvc2VyKXsKICAgICAgICAvLyBjb2RlLi4uCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHJpdmF0ZSBmdW5jdGlvbiBjdXJsKHN0cmluZyAkdXJsKXsKICAgICAgICAkY2ggPSBjdXJsX2luaXQoKTsKICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCAkdXJsKTsKICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUkVUVVJOVFJBTlNGRVIsIHRydWUpOwogICAgICAgICRvdXRwdXQgPSBjdXJsX2V4ZWMoJGNoKTsKICAgICAgICBjdXJsX2Nsb3NlKCRjaCk7CiAgICAgICAgcmV0dXJuICRvdXRwdXQ7CiAgICB9Cn0KCiRfRWFzeUdpdCA9IG5ldyBfRWFzeUdpdCgpOwo/Pg==",
    "autoload.php" => "PD9waHAKcmVxdWlyZSBkaXJuYW1lKF9fRklMRV9fKS4iL0dpdGh1YkFwaS5waHAiOwokanNvbiA9IGpzb25fZGVjb2RlKGltcGxvZGUoZmlsZShkaXJuYW1lKF9fRklMRV9fKS4iL21haW4uanNvbiIpKSk7CmZvcmVhY2ggKCRqc29uLT5wYWNrYWdlcyBhcyAkcGFja2FnZSkgJF9FYXN5R2l0LT5hdXRvbG9hZFBhY2thZ2UoJHBhY2thZ2UpOwo/Pg==",
    "main.json" => "ewoKICAgICJwYWNrYWdlcyI6IFsKICAgICAgICAic2tydGRldi9UZWxlZ3JhbUJvdC1BUEkiCiAgICBdCn0K"
];

foreach ($array as $key => $value) {
    file_put_contents(dirname(__FILE__)."/".$sha."/$key", base64_decode($value));
}

file_put_contents(dirname(__FILE__)."/autoload.php", '<?php
if(count(get_included_files()) == 1) die("Direct access not permitted.");
require dirname(__FILE__)."/'.$sha.'/autoload.php";
?>');
file_put_contents(__FILE__, base64_decode('PD9waHAKZWNobyAiSW5zdGFsbGF6aW9uZSBlc2VndWl0YSEiOwp1bmxpbmsoX19GSUxFX18pOwo/Pg=='));

echo "Ricarica la pagina";
?>
